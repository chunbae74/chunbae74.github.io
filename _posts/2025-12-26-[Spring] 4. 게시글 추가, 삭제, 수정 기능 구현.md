---
title: "[Spring] 4. 게시글 추가, 삭제, 수정 기능 구현"
author: chunbae
date: 2025-12-30 00:00:00 +0900
categories: [Spring, Coding_apple]
tags: [spring, controller, service, dependency_injection, url_parameter]
render_with_liquid: falses
---

## Dependency Injection (Controller, Service)

함수는 **하나의 역할**만 하는 것이 좋다.<br><br>
보통 **OOOController**에서는 URL에 맞춰 **HTML 파일을 return**해 주는 역할만 하고,<br>그 외 **기술적인 부분**은 **OOOService**에서 수행하도록 코드를 작성한다.

<br><br>

000Service에 선언한 메소드는 static이 아니므로 000Service 객체를 생성한 뒤에 사용해야 해야한다.
<br><br>
그러나 매 사용시마다 `new 000Service().methodName()` 코드를 호출하면 메모리나 성능 면에서 비효율적이다.
<br><br>
그 대신, class에 private static 필드로 한 번만 선언해 둔 뒤에 각 메소드에서 사용하도록 코드를 작성하는 것이 바람직하다.<br><br>
다음은 예시 코드이다.

<br>

```java
(ItemContoller.java)

@Controller
@RequiredArgsConstructor
public class ItemController {

    private final ItemRepository itemRepository;

    @GetMapping("/list")
    public String list(Model model) {
        List<Item> items = itemRepository.findAll();
        model.addAttribute("items", items);
        return "list.html";
    }

}
```

<br>위 함수를 다음과 같이 쪼갤 수 있다.

<br>

```java
(ItemController.java)

@Controller
@RequiredArgsConstructor
public class ItemController {

    private final ItemService itemService;

    @GetMapping("/list")
    public String list(Model model) {
        itemService.list(model);
        return "list.html";
    }

}
```
```java
(ItemService.java)

@Service
@RequiredArgsConstructor
public class ItemService {

    // DB에 접근하는 itemRepository는 파라미터로 전달받기보단, 
    // 그냥 전역 필드로 선언하는게 낫다.
    private final ItemRepository itemRepository;

    public void list(Model model) {
        List<Item> items = itemRepository.findAll();
        model.addAttribute("items", items);
    }

}
```

<br><br>ItemController에서 `private final ItemService itemService;` 부분이 핵심이다.

<br>

Class이름 위의 `@RequiredArgsConstructor` 어노테이션 덕분에 Spring이 자동으로 new ItemService() 객체를 itemService 필드에 넣어준다.
<br>이를 **Dependency Injection**이라 한다.

<br><br>

### Dependency Injection 사용이유

1. **결합도(Coupling) 감소**: 객체 간의 관계가 느슨해진다. 한 쪽을 수정해도 다른 쪽에 미치는 영향이 작아진단 뜻이다.<br>
2. **재사용성 향상**: 코드를 재사용하기 쉽다.<br>
3. **유닛 테스트 용이**: 실제 데이터베이스 등에 연결해야 하는 객체의 경우, 미리 준비한 가짜 데이터로 구성된 *Mock 객체*를 주입하여 테스트를 수행할 수 있다.<br>

<br><br>

## 게시글 추가 기능 만들기

추가 뿐 아니라 삭제, 수정 기능도 마찬가지겠지만<br>개발해야 하는 코드는 크게 다음과 같이 나눌 수 있다.<br><br>
1. [추가/삭제/수정] HTML 파일 작성<br>
2. [추가/삭제/수정] HTML 파일에서 데이터를 받아 Service로 넘기는 Controller 작성 <br>HTML파일에서는 `form`, `input` 태그를 통해 데이터를 넘겨줄 수 있다.<br>
3. Controller로부터 데이터를 넘겨받아 각종 작업을 수행하는 Service 작성<br>

<br><br>

### 1. 추가 HTML 파일 작성

```html
(write.html)

<body>
<form action="/add" method="POST">
    <input name="title">
    <input name="price">
    <button type="submit">Submit</button>
</form>
</body>
```

<br>주의: input을 만들 때 `name`속성을 정의해야만 서버로 데이터 전송이 된다.

<br><br>

`method` 속성에는 **GET** 또는 **POST**가 들어갈 수 있다.<br>
`action` 속성에는 요청을 날릴 URL 주소이다.
<br>Controller에서 `@GetMapping("/URL")`, `@PostMapping("/URL") 어노테이션을 통해 요청을 캐치할 수 있다.

<br><br>

### 2. Controller과 Service 작성

Controller에서 데이터를 넘겨받기 위해서는 **함수의 파라미터**를 작성해 주어야 한다.<br>

```java
(000Controller.java)

@PostMapping("/add")
String addItem(@RequestParam String title, @RequestParam Integer price) {
    System.out.printf("title = %s, price = %d\n", title, price);
    return "redirect:/list";
}
```

<br><br>정석은 각 파라미터 앞에 `@RequestParam` 어노테이션을 붙이는 것이지만,<br>다음과 같이 생략해도 괜찮다.<br>

```java
(000Controller.java)

@PostMapping("/add")
String addItem(String title, Integer price) {
    System.out.printf("title = %s, price = %d\n", title, price);
    return "redirect:/list";
}
```

<br>

> 참고<br>`RequestParam` 생략이 안 된다면 **파일-설정-java compiler 메뉴**에서<br>*additional command line parameter* 입력란에 *-parameters*가 잘 입력되어 있는지 확인해 보자.<br><br>그래도 안된다면 out폴더도 삭제 후 서버 재시작 해보면 된다.

<br><br>

만약 넘겨받아야 하는 데이터가 100만개라면?<br>이런 경우를 대비해 모든 데이터들을 **Map**에 담아 넘겨받을 수도 있다.<br>

```java
(000Controller.java)

@PostMapping("/add")
String addItem(@RequestParam Map<String, Object> formData) {
    ...
    return "redirect:/list";
}
```

<br>

---

<br>데이터를 넘겨받는 방법도 알았으니, 이제 게시글을 추가하는 코드를 작성해보겠다.
<br>

```java
(ItemController.java)

@Controller
@RequiredArgsConstructor
public class ItemController {

    private final ItemService itemService;

    @PostMapping("/add")
    public String addItem(String title, Integer price, Model model) {
        itemService.addItem(title, price, model);
        return "redirect:/list";
    }

}
```

```java
(ItemService.java)

@Service
@RequiredArgsConstructor
public class ItemService {

    private final ItemRepository itemRepository;

    public void addItem(String title, Integer price, Model model) {
        Item item = new Item();
        item.setTitle(title);
        item.setPrice(price);
        itemRepository.save(item);
    }

}
```

<br><br>

### @ModelAttribute 어노테이션

유저가 보낸 데이터를 obj로 바로 변환해 주는 어노테이션이다.
<br>
사용법은 다음과 같다.
<br><br>

```java
@PostMapping("/add")
public String addItem(@ModelAttribute Item item,  Model model) {

    itemRepository.save(item);
    return "redirect:/list";

}
```

<br><br>

## 상품 상세 페이지 만들기

### URL 파라미터

누군가가 `detail/1`에 접속하면 1번 상품 세부정보를,<br>`detail/2`에 접속하면 2번 상품 세부정보를 띄워주는 사이트를 만들어보자.
<br><br>
위 상황에서 URL 파라미터를 사용해 볼 수 있다.

```java
@GetMapping("/detail/{id}")
String detail(@PathVariable Long id) {

    System.out.println("상품 ID: " + id);
    return "detail.html";

}
```

서버에서 URL을 정할 때 {작명} 이런 걸 사용하면 **아무 문자**라는 뜻이 된다.<br>위 코드의 경우 사용자가 /detail/뒤에 아무 문자나 입력하면 이 API가 실행된다.
<br><br>
/detail/ 뒤에 오는 아무 문자는 `@PathVariable` 파라미터를 사용해 받아올 수 있다.<br>`@PathVariable Long id`는 /detail/뒤에 오는 아무 문자를 받아 와, Long형 id 변수 안에 집어넣는다.<br><br>만약 Long형으로 변환할 수 없으면 런타임 오류가 발생한다.

<br><br>

### ID로 DB 조회

findById() 메소드를 사용하면 특정 ID를 가진 행을 꺼내올 수 있다.<br>이 때 반환 타입은 Optional인데, 그 이유는 해당 ID를 가진 행이 DB에 있는지 없는지 확신할 수 없기 때문이다.

<br><br>

### 세부 페이지로 연결되는 링크 만들기

상품 list를 보여주는 페이지에<br>각 상품의 세부 정보를 확인할 수 있는 페이지로 연결되는 링크를 삽입해 봅시다.
<br><br>
HTML 태그 내 `href="URL"`를 사용하면 하이퍼링크가 생성됩니다.<br>저 URL 안에 서버에서 보낸 데이터를 집어넣고 싶을 땐 다음과 같은 특이한 문법으로 코드를 작성해야 합니다.<br>

```html
<a href="@{ '/detail/ + ${item.id} }">상세정보</a>
```

<br><br>

아래는 최종 코드이다.

```html
(list.html)

<div th:each="item: ${items}">
    <h4>
        <a th:text="${item.getTitle()}">상품명</a>
    </h4>
    <p th:text="${item.getPrice()}">가격</p>
    <a href="@{ '/detail/' + ${item.id} }">상세정보</a>
</div>
```

```html
(detail.html)

<h4>상품 상세 페이지입니다.</h4>
<p th:text=${item.getTitle()}>상품명</p>
<p th:text=${item.getPrice()}>가격</p>
```

```java
(ItemController.java)

@GetMapping("/detail/{id}")
public String getDetail(@PathVariable Long id, Model model) {

    String url = itemService.getDetail(id, model);
    return url;

}
```

```java
(ItemService.java)

public String getDetail(Long id, Model model) {

    Optional<Item> optional = itemRepository.findById(id);
    if (optional.isPresent()) {
        Item item = optional.get();
        model.addAttribute("item", item);
        return "detail.html";
    } else {
        return "redirect:/list";
    }
}
```

<br><br>

## 게시글 수정 기능 만들기

수정 기능을 구현하기 위해선 다음 과정대로 코드를 작성하면 된다.<br><br>1. list.html 페이지에서 '/edit/{id}'로 이어지는 하이퍼링크 생성<br>2. controller에서 url 파라미터로 '/edit/{id}' url 받은 뒤 edit.html 파일로 넘기기<br>3. edit.html 파일에서 내용 수정, submit 기능 구현<br>4. controller에서 submit 요청을 처리하는 API 작성

<br><br>

### 1. list.html 페이지에서 '/edit/{id}'로 이어지는 하이퍼링크 생성

```html
(list.html)

<div th:each="item : ${items}">
    <h4>
        <a th:text="${item.getTitle()}">상품명</a>
    </h4>
    <p th:text="${item.getPrice()}">가격</p>
    <a href="@{ '/edit/' + ${item.id} }">수정하기</a>
</div>
```

이미 위에서 detail 페이지를 만들어보며 작성했던 코드이기에, 추가적인 설명 없이 넘어가겠다.

<br><br>

### 2. controller에서 url 파라미터로 '/edit/{id}' url 받은 뒤 edit.html 파일로 넘기기

```java
(ItemController.java)

@GetMapping("/edit/{id}")
public String gotoEdit(@PathVariable Long id, Model model) {

    String url = itemService.gotoEdit(id, model);
    return url;

}
```

```java
(ItemService.java)

public String gotoEdit(Long id, Model model) {

    Optional<Item> optional = itemRepository.findById(id);

    if (optional.isPresent()) {
        Item item = optional.get();
        model.addAttribute("item", item);
        return "edit.html";
    } else {
        return "redirect:/list.html";
    }

}
```

이 또한 위에서 detail 기능을 구현하면서 설명한 코드이기에 별다른 설명은 하지 않겠다.

<br><br>

### 3. edit.html 파일에서 내용 수정, submit 기능 구현

```html
(edit.html)

<h4>상품 정보를 수정하는 창입니다.</h4>
<form action="/edit" method="POST">
    <input type="hidden" name="id" th:value="${item.id}" />
    <input name="title" th:value="${item.getTitle()"} />
    <input name="price" th:value=${item.getPrice()"} />
    <button type="submit">수정</button>
</form>
```

<br><br>
`value="내용"`을 통해 input 박스에 미리 값이 입력되어 있게 할 수 있다.<br>서버에서 넘겨준 데이터를 input 박스에 미리 입력시켜두고 싶다면 `th:value="${변수명}"`과 같이 작성하면 된다.

<br><br>

버튼을 누르게 되면 input에 입력된 값들이 /edit API가 호출되며, input 데이터들이 함께 넘어간다.<br><br>DB에서 내용 수정을 하는 방법은 간단하다. 같은 id를 가진 값을 저장하면, 내용이 덮어쓰기 되며 이는 수정한 것과 동일한 결과이다.<br><br>문제는 /edit API가 호출되었을 때, 어떤 id의 행을 수정해야 하는 지 모르기 때문에 <input name="id"> 를 통해 id값도 함께 넘겨준다.<br><br>사용자가 이 id값을 실수로 수정하지 않도록 type="hidden"을 통해 사용자 화면에서는 숨김 처리 한다.

<br><br>

### 4. controller에서 submit 요청을 처리하는 API 작성

```java
(ItemController.java)

@PostMapping("/edit")
public String edit(Long id, String title, Integer price) {

    itemService.edit(id, title, price);
    return "redirect:/list";

}
```

```java
(ItemService.java)

public void edit(Long id, String title, Integer price) {

    Item item = new Item();
    item.id = id;
    item.setTitle(title);
    item.setPrice(price);

    itemRepository.save(item);

}
```

<br><br>

## 게시물 삭제 기능 만들기

삭제 기능은 간단하다.<br><br>1. list.html 페이지에서 '/delete'을 호출하는 버튼 작성<br>2. controller에서 '/delete'를 처리하는 API 작성

### 1. list.html 페이지에서 '/delete'을 호출하는 버튼 작성

```html
(list.html)

<div th:each="item: ${items}">
    <h4>
        <a th:text="${item.getTitle()}">상품명</a>
    </h4>
    <p th:text="${item.getPrice()}">가격</p>
    <form action="/delete method="POST">
        <input type="hidden" name="id" th:value="${item.id}">
        <button type="submit">삭제</button>
    </form>
</div>
```

### 2. controller에서 '/delete'를 처리하는 API 작성

```java
(ItemController.java)

@PostMapping("/delete")
public String delete(Long id) {

    itemService.delete(id);
    return "redirect:/list";

}
```

```java
(ItemService.java)

public void delete(Long id) {
    
    itemRepository.deleteById(id);

}
```

<br><br>

## 출처
- [코딩애플 쉽게 배우는 Spring Boot & JPA](https://codingapple.com/course-status/)